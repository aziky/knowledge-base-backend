#version: '3.8'
#
services:
#  consul:
#    image: consul:1.14
#    ports:
#      - "8500:8500"
#      - "8600:8600/udp"
#      - "8600:8600/tcp"
#    extra_hosts:
#      - "host.docker.internal:host-gateway"
#    command: >
#      agent -dev -ui
#      -client=0.0.0.0
#      -bind=0.0.0.0
#    volumes:
#      - consul-data:/consul/data
#    healthcheck:
#      test: ["CMD", "consul", "members"]
#      interval: 10s
#      timeout: 3s
#      retries: 10
#      start_period: 10s
#    networks:
#      - kb-network
#

    redis:
      image: redis:7-alpine
      container_name: kb_redis
      ports:
        - "6379:6379"
      volumes:
        - redis_data:/data
      healthcheck:
        test: [ "CMD", "redis-cli", "ping" ]
        interval: 5s
        timeout: 3s
        retries: 5
        start_period: 10s
      networks:
        - kb_network

#
##  gateway-service:
##    build:
##      context: .
##      dockerfile: ./gateway-service/Dockerfile
##    image: kb-gateway-service:latest
##    ports:
##      - "7070:7070"
##    depends_on:
##      consul:
##        condition: service_healthy
##
##  user-service:
##    build:
##      context: .
##      dockerfile: ./user-service/Dockerfile
##    image: kb-user-service:latest
##    ports:
##      - "7071:7071"
##    depends_on:
##      consul:
##        condition: service_healthy
##      gateway-service:
##        condition: service_started
##
##  project-service:
##    build:
##      context: .
##      dockerfile: ./project-service/Dockerfile
##    image: kb-project-service:latest
##    ports:
##      - "7072:7072"
##    depends_on:
##      consul:
##        condition: service_healthy
##      gateway-service:
##        condition: service_started
#
#
volumes:
  redis_data:
    name: kb_redis_volume
    driver: local

#
networks:
  kb_network:
    driver: bridge